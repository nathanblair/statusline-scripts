#!/bin/bash

#$1 will be the battery instance
#$2 will be a flag to report with icon
#$3 will be a flag to report battery percentage back
#$4 will be a flag to report class (battery status)

[[ ! -z $1 ]] && battery_instance=$1 || battery_instance=0

battery_capacity=$(cat /sys/class/power_supply/BAT${battery_instance}/capacity)
battery_status=$(cat /sys/class/power_supply/BAT${battery_instance}/status)

acpi_bat_num=$(($battery_instance + 1))
battery_time=$(acpi -b | awk -v acpi_bat_num=$((battery_instance + 1)) 'NR == acpi_bat_num {print $5}')
[[ -z $battery_time ]] || battery_time="($(date -d ${battery_time} +%_H:%M))"

if [[ $2 -eq 1 ]]; then
    if [ $battery_status = "Full" ]; then
        battery_text=' ' && class="FULL"
    elif [ $battery_status = "Unknown" ]; then
        battery_text=' ' && class="UNK"
    elif [ $battery_status = "Discharging" ]; then
        ((battery_capacity <= 5)) &&
            battery_text=' ' && class="CRI"
        ((battery_capacity > 5 && battery_capacity <=25)) &&
            battery_text=' ' && class="DIS"
        ((battery_capacity > 25 && battery_capacity <=50)) &&
            battery_text=' ' && class="DIS"
        ((battery_capacity > 50 && battery_capacity <=75)) &&
            battery_text=' ' && class="DIS"
        ((battery_capacity > 75 && battery_capacity <=100)) &&
            battery_text=' ' && class="DIS"
    elif [ $battery_status = "Charging" ]; then
        ((battery_capacity <= 5)) &&
            battery_text=' ' && class="CHR"
        ((battery_capacity > 5 && battery_capacity <=25)) &&
            battery_text=' ' && class="CHR"
        ((battery_capacity > 25 && battery_capacity <=50)) &&
            battery_text=' ' && class="CHR"
        ((battery_capacity > 50 && battery_capacity <=75)) &&
            battery_text=' ' && class="CHR"
        ((battery_capacity > 75 && battery_capacity <=100)) &&
            battery_text=' ' && class="CHR"
    fi
else
    if [ $battery_status = "Full" ]; then
        battery_text="Full " && class="FULL"
    elif [ $battery_status = "Unknown" ]; then
        battery_text="UNK " && class="UNK"
    elif [ $battery_status = "Discharging" ]; then
        battery_text+="DIS "
    elif [ $battery_status = "Charging" ]; then
        battery_text+="CHR"
    fi
fi

if [[ $3 -eq 1 ]]; then
    battery_text+=${battery_capacity}%
fi

echo "$battery_text $battery_time"
echo $battery_text
if [[ $4 -eq 1 ]]; then echo $class; fi

